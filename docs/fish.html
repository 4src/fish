<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>fish API documentation</title>
<meta name="description" content="SYNOPSIS:
less: look around just a little, guess where to search.
(c) 2023 Tim Menzies &lt;timm@ieee.org&gt;, BSD-2 â€¦" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>fish</code></h1>
</header>
<section id="section-intro">
<p>SYNOPSIS: <br>
less: look around just a little, guess where to search.<br>
(c) 2023 Tim Menzies <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#116;&#105;&#109;&#109;&#64;&#105;&#101;&#101;&#101;&#46;&#111;&#114;&#103;">&#116;&#105;&#109;&#109;&#64;&#105;&#101;&#101;&#101;&#46;&#111;&#114;&#103;</a>, BSD-2
</p>
<p>USAGE:
<br>
./fish.py -f csvfile [OPTIONS] [ -g ACTION ] <br>
cat csvfile | ./fish.py [OPTIONS] [ -g ACTION ]
</p>
<p>OPTIONS:<br>
-b
&ndash;bins
max number of bins
= 16<br>
-c
&ndash;cohen
size significant separation = .35<br>
-f
&ndash;file
data csv file
= ../data/auto93.csv<br>
-g
&ndash;go
start-up action
= nothing
<br>
-h
&ndash;help
show help
= False<br>
-l
&ndash;lazy
lazy mode
= False<br>
-m
&ndash;min
min size
= .5<br>
-p
&ndash;p
distance coeffecient
= 2
<br>
-r
&ndash;rest
ratio best:rest
= 4<br>
-s
&ndash;seed
random number seed
= 1234567891<br>
-t
&ndash;top
explore top
ranges
= 8<br>
-w
&ndash;want
goal
= mitigate</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">#!/usr/bin/env python3 -B
#vim: set et sts=2 sw=2 ts=2 : 
&#34;&#34;&#34;
SYNOPSIS:   
  less: look around just a little, guess where to search.  
  (c) 2023 Tim Menzies &lt;timm@ieee.org&gt;, BSD-2  

USAGE:    
  ./fish.py -f csvfile [OPTIONS] [ -g ACTION ]   
  cat csvfile | ./fish.py [OPTIONS] [ -g ACTION ]    

OPTIONS:  
  -b  --bins    max number of bins    = 16  
  -c  --cohen   size significant separation = .35  
  -f  --file    data csv file         = ../data/auto93.csv  
  -g  --go      start-up action       = nothing    
  -h  --help    show help             = False  
  -l  --lazy    lazy mode             = False  
  -m  --min     min size              = .5  
  -p  --p       distance coeffecient  = 2    
  -r  --rest    ratio best:rest       = 4  
  -s  --seed    random number seed    = 1234567891  
  -t  --top     explore top  ranges   = 8  
  -w  --want    goal                  = mitigate&#34;&#34;&#34;
from fileinput import FileInput as file_or_stdin
import traceback,random,math,sys,re
from termcolor import colored
from functools import cmp_to_key
from ast import literal_eval
#---------------------------------------------
class pretty(object):
  &#34;Objects support pretty print, hiding privates slots (those starting with `_`)&#34;
  def __repr__(i):
    return i.__class__.__name__+str({k:v for k,v in i.__dict__.items() if k[0] != &#34;_&#34;})
#---------------------------------------------
class ROW(pretty):
  &#34;Place to store cells and meta-knowledge about those cells.&#34;
  def __init__(i, cells=[]): i.cells,i.klass = cells,None
  def at(i,col): return i.cells[col.at]
#---------------------------------------------
class COL(pretty):
  &#34;COLumns know the name, position and the count of rows seen.&#34;
  def __init__(i, txt=&#34;&#34;,at=0): i.n,i.at,i.txt = 0,at,txt
  def add(i,x):
    &#34;Ignoring empty cells, increment `n` then do the adding.&#34;
    if x != &#34;?&#34;:
      i.n += 1
      i.add1(x)
    return x
  def dist(i,x,y):
    &#34;distance between two values&#34;
    return 1 if x==&#34;?&#34; and y==&#34;?&#34; else i.dist1(x,y)
  def sub(i,x):
    &#34;Ignoring empty cells, decrement `n` then do the sub-trcting.&#34;
    if x != &#34;?&#34;:
      i.n -= 1
      i.sub1(x)
    return x
#---------------------------------------------
class NUM(COL):
  &#34;Summarize stream of numbers. Knows the mean and standard deviation.&#34;
  def __init__(i, txt=&#34;&#34;,at=0):
    COL.__init__(i,txt=txt,at=at)
    i.w = -1 if len(i.txt) &gt; 0 and i.txt[-1] == &#34;-&#34; else 1
    i.mu = i.m2 = 0
    i.lo, i.hi = big, -big 
  def add1(i,x):
    &#34;Update `lo,hi` and the variables needed to calculate stdev.&#34;
    i.lo = min(x, i.lo)
    i.hi = max(x, i.hi)
    delta = x - i.mu
    i.mu += delta/i.n
    i.m2 += delta*(x - i.mu)
  def dist1(i,x,y):
    &#34;distance between two values&#34;
    if   x==&#34;?&#34;: y = i.norm(y); x= 0 if y &gt; .5 else 1
    elif y==&#34;?&#34;: x = i.norm(x); y= 0 if x &gt; .5 else 1
    else: x,y = i.norm(x), i.norm(y)
    return abs(x - y)
  def div(i, decimals=None):
    &#34;Return diversity around the central tendency.&#34;
    return rnd((i.m2/(i.n - 1))**.5 if i.m2&gt;0 and i.n &gt; 1 else 0, decimals)
  def mid(i, decimals=None):
    &#34;Return central tendency.&#34;
    return rnd(i.mu, decimals)
  def norm(i,x):
    &#34;May `x` to 0..1 for `lo` to `hi`.&#34;
    return x if x==&#34;?&#34; else  (x-i.lo)/(i.hi - i.lo + 1/big)
  def sub1(i,x):
    &#34;decrement count&#34;
    if i.n &lt;= 1:
       i.n, i.mu, i.m2 = 0, 0, 0
    else:
      d = x - i.mu
      i.mu -= d / i.n
      i.m2 -= d * (x - i.mu)
#---------------------------------------------
class SYM(COL):
  &#34;Summary a stream of symbols. Knows mode and entropy.&#34;
  def __init__(i,txt=&#34;&#34;,at=0):
    COL.__init__(i,txt=txt,at=at)
    i.counts,i.mode, i.most = {},None,0
  def add1(i,x):
    &#34;Increment counts and mode.&#34;
    now = i.counts[x] = 1 + i.counts.get(x,0)
    if now &gt; i.most: i.most, i.mode = now, x
  def dist1(i,x,y):
    &#34;distance between two values&#34;
    return 0 if x==y else 1
  def div(i, decimals=None):
    &#34;Return diversity around the central tendency.&#34;
    a = i.counts
    return rnd( - sum(a[k]/i.n * math.log(a[k]/i.n,2) for k in a if a[k] &gt; 0), decimals)
  def mid(i,decimals=None):
    &#34;Return central tendency.&#34;
    return i.mode
  def sub1(i,x):
    &#34;Decrements counts.&#34;
    i.counts[x] -= 1
    assert 0 &lt;= i.counts[x]
#---------------------------------------------
class COLS(pretty):
  &#34;Convert a list of names into NUMs and SYMs (kept different binds of cols in different lists).&#34;
  def __init__(i,names):
    i.x, i.y, i.names = [],[],names
    i.all = [(NUM if s[0].isupper() else SYM)(at=n,txt=s) for n,s in enumerate(names)]
    for col in i.all:
      z = col.txt[-1]
      if z != &#34;X&#34;:
        if z==&#34;!&#34;: i.klass= col
        (i.y if z in &#34;-+!&#34; else i.x).append(col)
  def add(i,row):
    &#34;Add a row&#39;s data to all the non-skipped columns.&#34;
    for cols in [i.x, i.y]:
      for col in cols: col.add(row.at(col))
    return row
#---------------------------------------------
class DATA(pretty):
  &#34;Keep `rows` of data, summarized into col`umns.&#34;
  def __init__(i,src=[]):
    i.cols, i.rows = None,[]
    [i.add(row) for row in src]
  def add(i,row):
    &#34;For first row, build the `cols`. Otherwise, update summaries and the rows.&#34;
    if i.cols: i.rows += [i.cols.add(row)]
    else:      i.cols = COLS(row.cells)
  def clone(i,rows=[]):
    &#34;Replicate structure of self.&#34;
    return DATA([ROW(i.cols.names)] + rows)
  def dist(i,row1,row2):
    &#34;distance between two values&#34;
    return (sum(c.dist(row1.cells[c.at], row2.cells[c.at]) for c in i.cs.x)**the.p
           / len(i.cols.x))**(1/the.p)
  def sort2(i,row1,row2):
    &#34;Return True if `row1` better than `row2`.&#34;
    s1, s2, n = 0, 0, len(i.cols.y)
    for col in i.cols.y:
      a, b = col.norm(row1.at(col)), col.norm(row2.at(col))
      s1  -= math.exp(col.w * (a - b) / n)
      s2  -= math.exp(col.w * (b - a) / n)
    return s1 / n &lt; s2 / n
  def sorted(i,rows=[]):
    &#34;Sort all `rows`.&#34;
    return sorted(rows or i.rows, key=cmp_to_key(lambda a,b: i.sort2(a,b)))
  def stats(i,cols=None, fun=&#34;mid&#34;, decimals=2):
    &#34;Report statistics on a set of `col`umns (defaults to `i.cols.y`.&#34;
    cols = cols or i.cols.y
    def what(col): return col.mid(decimals) if fun==&#34;mid&#34; else col.div(decimals)
    return BAG(mid=BAG(**{&#34;N+&#34;:cols[0].n, **{col.txt:what(col) for col in cols}}))
#---------------------------------------------
# operators, used in trees
ops = {&#34;&gt;&#34;  : lambda x,y: x==&#34;?&#34; or y==&#34;?&#34; or x&gt;y,
       &#34;&lt;=&#34; : lambda x,y: x==&#34;?&#34; or y==&#34;?&#34; or x&lt;=y,
       &#34;==&#34; : lambda x,y: x==&#34;?&#34; or y==&#34;?&#34; or x==y,
       &#34;!=&#34; : lambda x,y: x==&#34;?&#34; or y==&#34;?&#34; or x!=y}
&#34;&#34;&#34;Operators used in decision tree.&#34;&#34;&#34;

neg = { &#34;&gt;&#34;  :  &#34;&lt;=&#34;,
        &#34;&lt;=&#34; :  &#34;&gt;&#34;,
        &#34;==&#34; :  &#34;!=&#34;,
        &#34;!=&#34; :  &#34;==&#34; }
&#34;&#34;&#34;Negation of operators.&#34;&#34;&#34;
#---------------------------------------------
# tree generation
class TREE(object):
  &#34;Recursively split on the cut (that most distinguishes different klasses).&#34;
  def __init__(i,data):
    lst   = data.sorted()
    n     = int(len(lst)**the.min)
    bests = lst[-n:]
    rests = lst[:n*the.rest]
    for row in bests: row.klass = True
    for row in rests: row.klass = False
    i.data = data
    top = i.data.clone(bests+rests)
    i.stop = 2*len(top.rows)**the.min
    i.root = i.grow(top.rows,  BAG(here=top,at=None))

  def grow(i,rows, t):
    t.left,t.right = None,None
    if len(rows) &gt;= i.stop:
      _,at,op,cut,s = i.cut(i.data, i.data.cols.x, rows)
      if cut:
        left,right = [],[]
        [(left if ops[op](row.cells[at], cut) else right).append(row) for row in rows]
        if len(left) != len(rows) and len(right) != len(rows):
          t.left = i.grow(left,  BAG(here=i.data.clone(left), at=at,cut=cut,txt=s,op=op))
          t.right= i.grow(right, BAG(here=i.data.clone(right),at=at,cut=cut,txt=s,op=neg[op]))
    return t

  def cut(i,data,cols,rows):
    &#34;Return best `div,at,op,cut,txt` that most divides the klasses in `rows`.&#34;
    def sym(col):
      &#34;For syms, just return the one with least diversity of klasses.&#34;
      d = {}
      for row in rows:
        x = row.at(col)
        if x !=  &#34;?&#34;:
          d[x] = d.get(x, None) or SYM()
          d[x].cut = x
          d[x].add(row.klass)
      best = sorted(d.values(), key=lambda s:s.div())[0]
      return best.div(), col.at,&#34;==&#34;,best.cut if best.n &lt; col.n else None,col.txt
    #-----------
    def num(col):
      &#34;For nums, just return the cut that most reduces expected diversity.&#34;
      X     = lambda row: row.at(col)
      eps   = col.div()*the.cohen
      small = len(rows)**the.min
      all   = sorted([row for row in rows if X(row) != &#34;?&#34;], key=X)
      d1,d2,a,z = SYM(), SYM(), X(all[0]), X(all[-1])
      [d2.add(row.klass) for row in all]
      cut,n2,lo = None,len(all),d2.div()
      for n1,row in enumerate(all):
        n2, x, y = n2-1, X(row), row.klass
        d2.sub( d1.add(y) )
        if n1 &gt; small and n2 &gt; small and x != X(all[n1+1]) and x-a &gt; eps and z-x &gt; eps:
          xpect = (d1.div()*n1 + d2.div()*n2)/(n1+n2)
          if xpect &lt; lo:
            cut,lo = x,xpect
      return lo,col.at,&#34;&lt;=&#34;,cut,col.txt
    #------------------------------------
    return sorted([(num(col) if isa(col,NUM) else sym(col)) for col in cols])[0]

  def show(i):
    for lvl,t,isLeaf in i.nodes():
      if lvl==0:
        print(&#34;&#34;)
        print(t.here.stats().mid,end=&#34;&#34;)
      else:
        print(&#34;\n&#34;+(&#34;|.. &#34; * lvl)+ f&#34;{t.txt} {t.op} {t.cut} &#34;,end=&#34;&#34;)
        if isLeaf:  print(t.here.stats().mid,end=&#34;&#34;)
    print(&#34;&#34;)

  def nodes(i,t=None,lvl=0):
    t = t or i.root
    yield lvl,t,t.left==None
    for t1 in [t.left,t.right]:
      if t1:
        for lvl2,t2,isLeaf in i.nodes(t1,lvl+1): yield lvl2,t2, isLeaf

#---------------------------------------------
R   = random.random      # short cut to random number generator
isa = isinstance         # short cut for checking types

big = 1E30
&#34;&#34;&#34;large numbers&#34;&#34;&#34;

class BAG(dict):
  &#34;Dictionaries that can be accessed via `x[\&#34;slot\&#34;]` or `x.slot`.&#34;
  __getattr__ = dict.get

class SETTINGS(BAG):
  &#34;Parse settings from string.&#34;
  def __init__(i,s):
    for m in re.finditer(r&#34;\n\s*-\w+\s*--(\w+)[^=]*=\s*(\S+)&#34;,s): i[m[1]] = coerce(m[2])
  def cli(i):
    &#34;&#34;&#34;For k,v in i, update `v` if there is a command-line flag `-k[0]` or `--k`. Note
    that bookean values need no argument (since we will just negate `v`).&#34;&#34;&#34;
    for k,v in i.items():
      v = str(v)
      for j,x in enumerate(sys.argv):
        if (&#34;-&#34;+k[0]) == x or (&#34;--&#34;+k) == x:
          v = &#34;True&#34; if v==&#34;False&#34; else (&#34;False&#34; if v==&#34;True&#34; else sys.argv[j+1])
      i[k] = coerce(v)
  def showHelp(i,s):
    &#34;pretty print help string&#34;
    def bold(m):   return colored(m[0], attrs=[&#34;bold&#34;])
    def bright(m): return colored(m[0], &#34;light_yellow&#34;)
    def pretty(s): return re.sub(&#34;\n[A-Z][A-Z]+:&#34;, bold, re.sub(&#34; [-][-]?[\S]+&#34;, bright, s))
    print(pretty(s))
    print(pretty(&#34;\nACTIONS:&#34;))
    [print(pretty(f&#34;  -g   {k:8} {f.__doc__}&#34;)) for k,f in Egs.all.items() if k[0].isupper()]

def coerce(x):
  try: return literal_eval(x)
  except: return x

def csv(file, filter=ROW):
  &#34;Returns an iterator that returns lists from standard input (-) or a file.&#34;
  if file==&#34;-&#34;: file=None
  with file_or_stdin(file) as src:
    for line in src:
      line = re.sub(r&#39;([\n\t\r&#34;\&#39; ]|#.*)&#39;, &#39;&#39;, line)
      if line:
        yield filter([coerce(s.strip()) for s in line.split(&#34;,&#34;)])

def rnd(x,decimals=None):
  return x if decimals==None else round(x,decimals)

def yell(s,c):
  &#34;Print string `s`, colored by `c`.&#34;
  print(colored(s,&#34;light_&#34;+c,attrs=[&#34;bold&#34;]),end=&#34;&#34;)
#----------------------------------------------------
class Egs:
  &#34;Place to store the examples.&#34;
  all = locals()

  csv = [ &#34;pom.csv&#34;,
         &#34;nasa93dem.csv&#34;,
         &#34;healthCloseIsses12mths0011-easy.csv&#34;,
         &#34;healthCloseIsses12mths0001-hard.csv&#34;,
         &#34;coc10000.csv&#34;,
         &#34;coc1000.csv&#34;,
         &#34;china.csv&#34;,
         &#34;auto93.csv&#34;,
         &#34;auto2.csv&#34;,
         &#34;SSN.csv&#34;,
         &#34;SSM.csv&#34;]

  def ok():
    &#34;Run everything (except ok,h). Return how often something fails.&#34;
    fails, saved = 0, {k:v for k,v in the.items()}
    for what,fun in Egs.all.items():
      if what[0].isupper():
        yell(what + &#34; &#34;,&#34;yellow&#34;)
        fail = Egs.failure(saved,fun)
        yell(&#34; FAIL\n&#34;,&#34;red&#34;) if fail else yell(&#34; PASS\n&#34;,&#34;green&#34;)
        fails += fail
    yell(f&#34;TOTAL FAILURE(s) = {fails}\n&#34;, &#34;red&#34; if fails &gt; 0 else &#34;cyan&#34;)
    sys.exit(fails)

  def failure(saved,fun):
    &#34;&#34;&#34;Called by `Egs.ok`. `Fun` fails if it returns `False` or if it crashes.
    If it crashes, print the stack dump but then continue on
    Before running it, reset the system to  initial conditions.&#34;&#34;&#34;
    for k,v in saved.items(): the[k] = v
    random.seed(the.seed)
    fail = False
    try:    fail = fun() == False  # here, fail might be reset to True
    except: fail = True; traceback.print_exc()
    return fail

  def The():
    &#34;print the settings&#34;
    print(the)

  def Rnd():
    &#34;rnd to 2 decimals&#34;
    return 3.14 == rnd(math.pi,2)

  def Num(txt=&#34;&#34;):
    &#34;test NUMs&#34;
    n = NUM(txt)
    for x in range(10**4):  n.add(R()**.5)
    return .66 &lt; n.mid() &lt; .67 and .23 &lt;  n.div() &lt; .24 and n

  def Sym(txt=&#34;&#34;):
    &#34;test SYMs&#34;
    s=SYM(txt)
    [s.add(x) for x in &#34;aaaabbc&#34;]
    return &#34;a&#34;==s.mid() and 1.37 &lt;= s.div() &lt; 1.38 and s

  def Rows():
    &#34;Check we can load rows from file.&#34;
    print(the.file)
    for row in list(csv(the.file))[:5]: print(row) #[:5]: print(row)

  def Col():
    &#34;Check we can convert names to NUMs and SYMs.&#34;
    [print(x) for x in COLS([&#34;name&#34;,&#34;Age&#34;,&#34;Weight-&#34;]).all]

  def Data():
    &#34;Can we load data and get its stats?&#34;
    DATA(csv(the.file)).stats()

  def Clone():
    &#34;Can we replicate a DATA&#39;s structure?&#34;
    d1 = DATA(csv(the.file))
    d2= d1.clone(d1.rows)
    print(d1.cols.y[1])
    print(d2.cols.y[1])

  def Sorts():
    &#34;Can we sort rows into `best` and `rest`?&#34;
    d = DATA(csv(the.file))
    lst = d.sorted()
    m   = int(len(lst)**.5)
    best= d.clone(lst[-m:]);         print(&#34;all &#34;,d.stats())
    best= d.clone(lst[-m:]);         print(&#34;best&#34;,best.stats())
    rest= d.clone(lst[:m*the.rest]); print(&#34;rest&#34;,rest.stats())

  def Nodes():
    &#34;Does the TREE iterator work?&#34;
    t1 = TREE(DATA(csv(the.file)))
    for lvl,t2,isLeaf in t1.nodes():
        print(&#34;|.. &#34; * lvl,isLeaf)

  def Tree():
    &#34;Does the TREE pretty print work?&#34;
    TREE( DATA(csv(the.file)) ).show()

  def Trees():
    &#34;Test all tree generation of all csv files.&#34;
    for f in Egs.csv:
      print(&#34;\n\n-----------&#34;,f)
      TREE( DATA(csv(f&#34;../data/{f}&#34;)) ).show()

#---------------------------------------------


the = SETTINGS(__doc__)
&#34;&#34;&#34;Config options, parsed from `__doc__`&#34;&#34;&#34;
random.seed(the.seed)    # set random number seed

if __name__ == &#34;__main__&#34;:
  the.cli()
  if the.help: the.showHelp(__doc__)
  elif the.go in Egs.all and callable(Egs.all[the.go]):
         Egs.all[the.go]()</code></pre>
</details>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-variables">Global variables</h2>
<dl>
<dt id="fish.ops"><code class="name">var <span class="ident">ops</span></code></dt>
<dd>
<div class="desc"><p>Operators used in decision tree.</p></div>
</dd>
<dt id="fish.neg"><code class="name">var <span class="ident">neg</span></code></dt>
<dd>
<div class="desc"><p>Negation of operators.</p></div>
</dd>
<dt id="fish.big"><code class="name">var <span class="ident">big</span></code></dt>
<dd>
<div class="desc"><p>large numbers</p></div>
</dd>
<dt id="fish.the"><code class="name">var <span class="ident">the</span></code></dt>
<dd>
<div class="desc"><p>Config options, parsed from <code>__doc__</code></p></div>
</dd>
</dl>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="fish.R"><code class="name flex">
<span>def <span class="ident">R</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>random() -&gt; x in the interval [0, 1).</p></div>
</dd>
<dt id="fish.coerce"><code class="name flex">
<span>def <span class="ident">coerce</span></span>(<span>x)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def coerce(x):
  try: return literal_eval(x)
  except: return x</code></pre>
</details>
</dd>
<dt id="fish.csv"><code class="name flex">
<span>def <span class="ident">csv</span></span>(<span>file, filter=fish.ROW)</span>
</code></dt>
<dd>
<div class="desc"><p>Returns an iterator that returns lists from standard input (-) or a file.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def csv(file, filter=ROW):
  &#34;Returns an iterator that returns lists from standard input (-) or a file.&#34;
  if file==&#34;-&#34;: file=None
  with file_or_stdin(file) as src:
    for line in src:
      line = re.sub(r&#39;([\n\t\r&#34;\&#39; ]|#.*)&#39;, &#39;&#39;, line)
      if line:
        yield filter([coerce(s.strip()) for s in line.split(&#34;,&#34;)])</code></pre>
</details>
</dd>
<dt id="fish.rnd"><code class="name flex">
<span>def <span class="ident">rnd</span></span>(<span>x, decimals=None)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def rnd(x,decimals=None):
  return x if decimals==None else round(x,decimals)</code></pre>
</details>
</dd>
<dt id="fish.yell"><code class="name flex">
<span>def <span class="ident">yell</span></span>(<span>s, c)</span>
</code></dt>
<dd>
<div class="desc"><p>Print string <code>s</code>, colored by <code>c</code>.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def yell(s,c):
  &#34;Print string `s`, colored by `c`.&#34;
  print(colored(s,&#34;light_&#34;+c,attrs=[&#34;bold&#34;]),end=&#34;&#34;)</code></pre>
</details>
</dd>
</dl>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="fish.pretty"><code class="flex name class">
<span>class <span class="ident">pretty</span></span>
</code></dt>
<dd>
<div class="desc"><p>Objects support pretty print, hiding privates slots (those starting with <code>_</code>)</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class pretty(object):
  &#34;Objects support pretty print, hiding privates slots (those starting with `_`)&#34;
  def __repr__(i):
    return i.__class__.__name__+str({k:v for k,v in i.__dict__.items() if k[0] != &#34;_&#34;})</code></pre>
</details>
<h3>Subclasses</h3>
<ul class="hlist">
<li><a title="fish.COL" href="#fish.COL">COL</a></li>
<li><a title="fish.COLS" href="#fish.COLS">COLS</a></li>
<li><a title="fish.DATA" href="#fish.DATA">DATA</a></li>
<li><a title="fish.ROW" href="#fish.ROW">ROW</a></li>
</ul>
</dd>
<dt id="fish.ROW"><code class="flex name class">
<span>class <span class="ident">ROW</span></span>
<span>(</span><span>cells=[])</span>
</code></dt>
<dd>
<div class="desc"><p>Place to store cells and meta-knowledge about those cells.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class ROW(pretty):
  &#34;Place to store cells and meta-knowledge about those cells.&#34;
  def __init__(i, cells=[]): i.cells,i.klass = cells,None
  def at(i,col): return i.cells[col.at]</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="fish.pretty" href="#fish.pretty">pretty</a></li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="fish.ROW.at"><code class="name flex">
<span>def <span class="ident">at</span></span>(<span>i, col)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def at(i,col): return i.cells[col.at]</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="fish.COL"><code class="flex name class">
<span>class <span class="ident">COL</span></span>
<span>(</span><span>txt='', at=0)</span>
</code></dt>
<dd>
<div class="desc"><p>COLumns know the name, position and the count of rows seen.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class COL(pretty):
  &#34;COLumns know the name, position and the count of rows seen.&#34;
  def __init__(i, txt=&#34;&#34;,at=0): i.n,i.at,i.txt = 0,at,txt
  def add(i,x):
    &#34;Ignoring empty cells, increment `n` then do the adding.&#34;
    if x != &#34;?&#34;:
      i.n += 1
      i.add1(x)
    return x
  def dist(i,x,y):
    &#34;distance between two values&#34;
    return 1 if x==&#34;?&#34; and y==&#34;?&#34; else i.dist1(x,y)
  def sub(i,x):
    &#34;Ignoring empty cells, decrement `n` then do the sub-trcting.&#34;
    if x != &#34;?&#34;:
      i.n -= 1
      i.sub1(x)
    return x</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="fish.pretty" href="#fish.pretty">pretty</a></li>
</ul>
<h3>Subclasses</h3>
<ul class="hlist">
<li><a title="fish.NUM" href="#fish.NUM">NUM</a></li>
<li><a title="fish.SYM" href="#fish.SYM">SYM</a></li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="fish.COL.add"><code class="name flex">
<span>def <span class="ident">add</span></span>(<span>i, x)</span>
</code></dt>
<dd>
<div class="desc"><p>Ignoring empty cells, increment <code>n</code> then do the adding.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def add(i,x):
  &#34;Ignoring empty cells, increment `n` then do the adding.&#34;
  if x != &#34;?&#34;:
    i.n += 1
    i.add1(x)
  return x</code></pre>
</details>
</dd>
<dt id="fish.COL.dist"><code class="name flex">
<span>def <span class="ident">dist</span></span>(<span>i, x, y)</span>
</code></dt>
<dd>
<div class="desc"><p>distance between two values</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def dist(i,x,y):
  &#34;distance between two values&#34;
  return 1 if x==&#34;?&#34; and y==&#34;?&#34; else i.dist1(x,y)</code></pre>
</details>
</dd>
<dt id="fish.COL.sub"><code class="name flex">
<span>def <span class="ident">sub</span></span>(<span>i, x)</span>
</code></dt>
<dd>
<div class="desc"><p>Ignoring empty cells, decrement <code>n</code> then do the sub-trcting.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def sub(i,x):
  &#34;Ignoring empty cells, decrement `n` then do the sub-trcting.&#34;
  if x != &#34;?&#34;:
    i.n -= 1
    i.sub1(x)
  return x</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="fish.NUM"><code class="flex name class">
<span>class <span class="ident">NUM</span></span>
<span>(</span><span>txt='', at=0)</span>
</code></dt>
<dd>
<div class="desc"><p>Summarize stream of numbers. Knows the mean and standard deviation.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class NUM(COL):
  &#34;Summarize stream of numbers. Knows the mean and standard deviation.&#34;
  def __init__(i, txt=&#34;&#34;,at=0):
    COL.__init__(i,txt=txt,at=at)
    i.w = -1 if len(i.txt) &gt; 0 and i.txt[-1] == &#34;-&#34; else 1
    i.mu = i.m2 = 0
    i.lo, i.hi = big, -big 
  def add1(i,x):
    &#34;Update `lo,hi` and the variables needed to calculate stdev.&#34;
    i.lo = min(x, i.lo)
    i.hi = max(x, i.hi)
    delta = x - i.mu
    i.mu += delta/i.n
    i.m2 += delta*(x - i.mu)
  def dist1(i,x,y):
    &#34;distance between two values&#34;
    if   x==&#34;?&#34;: y = i.norm(y); x= 0 if y &gt; .5 else 1
    elif y==&#34;?&#34;: x = i.norm(x); y= 0 if x &gt; .5 else 1
    else: x,y = i.norm(x), i.norm(y)
    return abs(x - y)
  def div(i, decimals=None):
    &#34;Return diversity around the central tendency.&#34;
    return rnd((i.m2/(i.n - 1))**.5 if i.m2&gt;0 and i.n &gt; 1 else 0, decimals)
  def mid(i, decimals=None):
    &#34;Return central tendency.&#34;
    return rnd(i.mu, decimals)
  def norm(i,x):
    &#34;May `x` to 0..1 for `lo` to `hi`.&#34;
    return x if x==&#34;?&#34; else  (x-i.lo)/(i.hi - i.lo + 1/big)
  def sub1(i,x):
    &#34;decrement count&#34;
    if i.n &lt;= 1:
       i.n, i.mu, i.m2 = 0, 0, 0
    else:
      d = x - i.mu
      i.mu -= d / i.n
      i.m2 -= d * (x - i.mu)</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="fish.COL" href="#fish.COL">COL</a></li>
<li><a title="fish.pretty" href="#fish.pretty">pretty</a></li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="fish.NUM.add1"><code class="name flex">
<span>def <span class="ident">add1</span></span>(<span>i, x)</span>
</code></dt>
<dd>
<div class="desc"><p>Update <code>lo,hi</code> and the variables needed to calculate stdev.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def add1(i,x):
  &#34;Update `lo,hi` and the variables needed to calculate stdev.&#34;
  i.lo = min(x, i.lo)
  i.hi = max(x, i.hi)
  delta = x - i.mu
  i.mu += delta/i.n
  i.m2 += delta*(x - i.mu)</code></pre>
</details>
</dd>
<dt id="fish.NUM.dist1"><code class="name flex">
<span>def <span class="ident">dist1</span></span>(<span>i, x, y)</span>
</code></dt>
<dd>
<div class="desc"><p>distance between two values</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def dist1(i,x,y):
  &#34;distance between two values&#34;
  if   x==&#34;?&#34;: y = i.norm(y); x= 0 if y &gt; .5 else 1
  elif y==&#34;?&#34;: x = i.norm(x); y= 0 if x &gt; .5 else 1
  else: x,y = i.norm(x), i.norm(y)
  return abs(x - y)</code></pre>
</details>
</dd>
<dt id="fish.NUM.div"><code class="name flex">
<span>def <span class="ident">div</span></span>(<span>i, decimals=None)</span>
</code></dt>
<dd>
<div class="desc"><p>Return diversity around the central tendency.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def div(i, decimals=None):
  &#34;Return diversity around the central tendency.&#34;
  return rnd((i.m2/(i.n - 1))**.5 if i.m2&gt;0 and i.n &gt; 1 else 0, decimals)</code></pre>
</details>
</dd>
<dt id="fish.NUM.mid"><code class="name flex">
<span>def <span class="ident">mid</span></span>(<span>i, decimals=None)</span>
</code></dt>
<dd>
<div class="desc"><p>Return central tendency.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def mid(i, decimals=None):
  &#34;Return central tendency.&#34;
  return rnd(i.mu, decimals)</code></pre>
</details>
</dd>
<dt id="fish.NUM.norm"><code class="name flex">
<span>def <span class="ident">norm</span></span>(<span>i, x)</span>
</code></dt>
<dd>
<div class="desc"><p>May <code>x</code> to 0..1 for <code>lo</code> to <code>hi</code>.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def norm(i,x):
  &#34;May `x` to 0..1 for `lo` to `hi`.&#34;
  return x if x==&#34;?&#34; else  (x-i.lo)/(i.hi - i.lo + 1/big)</code></pre>
</details>
</dd>
<dt id="fish.NUM.sub1"><code class="name flex">
<span>def <span class="ident">sub1</span></span>(<span>i, x)</span>
</code></dt>
<dd>
<div class="desc"><p>decrement count</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def sub1(i,x):
  &#34;decrement count&#34;
  if i.n &lt;= 1:
     i.n, i.mu, i.m2 = 0, 0, 0
  else:
    d = x - i.mu
    i.mu -= d / i.n
    i.m2 -= d * (x - i.mu)</code></pre>
</details>
</dd>
</dl>
<h3>Inherited members</h3>
<ul class="hlist">
<li><code><b><a title="fish.COL" href="#fish.COL">COL</a></b></code>:
<ul class="hlist">
<li><code><a title="fish.COL.add" href="#fish.COL.add">add</a></code></li>
<li><code><a title="fish.COL.dist" href="#fish.COL.dist">dist</a></code></li>
<li><code><a title="fish.COL.sub" href="#fish.COL.sub">sub</a></code></li>
</ul>
</li>
</ul>
</dd>
<dt id="fish.SYM"><code class="flex name class">
<span>class <span class="ident">SYM</span></span>
<span>(</span><span>txt='', at=0)</span>
</code></dt>
<dd>
<div class="desc"><p>Summary a stream of symbols. Knows mode and entropy.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class SYM(COL):
  &#34;Summary a stream of symbols. Knows mode and entropy.&#34;
  def __init__(i,txt=&#34;&#34;,at=0):
    COL.__init__(i,txt=txt,at=at)
    i.counts,i.mode, i.most = {},None,0
  def add1(i,x):
    &#34;Increment counts and mode.&#34;
    now = i.counts[x] = 1 + i.counts.get(x,0)
    if now &gt; i.most: i.most, i.mode = now, x
  def dist1(i,x,y):
    &#34;distance between two values&#34;
    return 0 if x==y else 1
  def div(i, decimals=None):
    &#34;Return diversity around the central tendency.&#34;
    a = i.counts
    return rnd( - sum(a[k]/i.n * math.log(a[k]/i.n,2) for k in a if a[k] &gt; 0), decimals)
  def mid(i,decimals=None):
    &#34;Return central tendency.&#34;
    return i.mode
  def sub1(i,x):
    &#34;Decrements counts.&#34;
    i.counts[x] -= 1
    assert 0 &lt;= i.counts[x]</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="fish.COL" href="#fish.COL">COL</a></li>
<li><a title="fish.pretty" href="#fish.pretty">pretty</a></li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="fish.SYM.add1"><code class="name flex">
<span>def <span class="ident">add1</span></span>(<span>i, x)</span>
</code></dt>
<dd>
<div class="desc"><p>Increment counts and mode.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def add1(i,x):
  &#34;Increment counts and mode.&#34;
  now = i.counts[x] = 1 + i.counts.get(x,0)
  if now &gt; i.most: i.most, i.mode = now, x</code></pre>
</details>
</dd>
<dt id="fish.SYM.dist1"><code class="name flex">
<span>def <span class="ident">dist1</span></span>(<span>i, x, y)</span>
</code></dt>
<dd>
<div class="desc"><p>distance between two values</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def dist1(i,x,y):
  &#34;distance between two values&#34;
  return 0 if x==y else 1</code></pre>
</details>
</dd>
<dt id="fish.SYM.div"><code class="name flex">
<span>def <span class="ident">div</span></span>(<span>i, decimals=None)</span>
</code></dt>
<dd>
<div class="desc"><p>Return diversity around the central tendency.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def div(i, decimals=None):
  &#34;Return diversity around the central tendency.&#34;
  a = i.counts
  return rnd( - sum(a[k]/i.n * math.log(a[k]/i.n,2) for k in a if a[k] &gt; 0), decimals)</code></pre>
</details>
</dd>
<dt id="fish.SYM.mid"><code class="name flex">
<span>def <span class="ident">mid</span></span>(<span>i, decimals=None)</span>
</code></dt>
<dd>
<div class="desc"><p>Return central tendency.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def mid(i,decimals=None):
  &#34;Return central tendency.&#34;
  return i.mode</code></pre>
</details>
</dd>
<dt id="fish.SYM.sub1"><code class="name flex">
<span>def <span class="ident">sub1</span></span>(<span>i, x)</span>
</code></dt>
<dd>
<div class="desc"><p>Decrements counts.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def sub1(i,x):
  &#34;Decrements counts.&#34;
  i.counts[x] -= 1
  assert 0 &lt;= i.counts[x]</code></pre>
</details>
</dd>
</dl>
<h3>Inherited members</h3>
<ul class="hlist">
<li><code><b><a title="fish.COL" href="#fish.COL">COL</a></b></code>:
<ul class="hlist">
<li><code><a title="fish.COL.add" href="#fish.COL.add">add</a></code></li>
<li><code><a title="fish.COL.dist" href="#fish.COL.dist">dist</a></code></li>
<li><code><a title="fish.COL.sub" href="#fish.COL.sub">sub</a></code></li>
</ul>
</li>
</ul>
</dd>
<dt id="fish.COLS"><code class="flex name class">
<span>class <span class="ident">COLS</span></span>
<span>(</span><span>names)</span>
</code></dt>
<dd>
<div class="desc"><p>Convert a list of names into NUMs and SYMs (kept different binds of cols in different lists).</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class COLS(pretty):
  &#34;Convert a list of names into NUMs and SYMs (kept different binds of cols in different lists).&#34;
  def __init__(i,names):
    i.x, i.y, i.names = [],[],names
    i.all = [(NUM if s[0].isupper() else SYM)(at=n,txt=s) for n,s in enumerate(names)]
    for col in i.all:
      z = col.txt[-1]
      if z != &#34;X&#34;:
        if z==&#34;!&#34;: i.klass= col
        (i.y if z in &#34;-+!&#34; else i.x).append(col)
  def add(i,row):
    &#34;Add a row&#39;s data to all the non-skipped columns.&#34;
    for cols in [i.x, i.y]:
      for col in cols: col.add(row.at(col))
    return row</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="fish.pretty" href="#fish.pretty">pretty</a></li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="fish.COLS.add"><code class="name flex">
<span>def <span class="ident">add</span></span>(<span>i, row)</span>
</code></dt>
<dd>
<div class="desc"><p>Add a row's data to all the non-skipped columns.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def add(i,row):
  &#34;Add a row&#39;s data to all the non-skipped columns.&#34;
  for cols in [i.x, i.y]:
    for col in cols: col.add(row.at(col))
  return row</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="fish.DATA"><code class="flex name class">
<span>class <span class="ident">DATA</span></span>
<span>(</span><span>src=[])</span>
</code></dt>
<dd>
<div class="desc"><p>Keep <code>rows</code> of data, summarized into col`umns.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class DATA(pretty):
  &#34;Keep `rows` of data, summarized into col`umns.&#34;
  def __init__(i,src=[]):
    i.cols, i.rows = None,[]
    [i.add(row) for row in src]
  def add(i,row):
    &#34;For first row, build the `cols`. Otherwise, update summaries and the rows.&#34;
    if i.cols: i.rows += [i.cols.add(row)]
    else:      i.cols = COLS(row.cells)
  def clone(i,rows=[]):
    &#34;Replicate structure of self.&#34;
    return DATA([ROW(i.cols.names)] + rows)
  def dist(i,row1,row2):
    &#34;distance between two values&#34;
    return (sum(c.dist(row1.cells[c.at], row2.cells[c.at]) for c in i.cs.x)**the.p
           / len(i.cols.x))**(1/the.p)
  def sort2(i,row1,row2):
    &#34;Return True if `row1` better than `row2`.&#34;
    s1, s2, n = 0, 0, len(i.cols.y)
    for col in i.cols.y:
      a, b = col.norm(row1.at(col)), col.norm(row2.at(col))
      s1  -= math.exp(col.w * (a - b) / n)
      s2  -= math.exp(col.w * (b - a) / n)
    return s1 / n &lt; s2 / n
  def sorted(i,rows=[]):
    &#34;Sort all `rows`.&#34;
    return sorted(rows or i.rows, key=cmp_to_key(lambda a,b: i.sort2(a,b)))
  def stats(i,cols=None, fun=&#34;mid&#34;, decimals=2):
    &#34;Report statistics on a set of `col`umns (defaults to `i.cols.y`.&#34;
    cols = cols or i.cols.y
    def what(col): return col.mid(decimals) if fun==&#34;mid&#34; else col.div(decimals)
    return BAG(mid=BAG(**{&#34;N+&#34;:cols[0].n, **{col.txt:what(col) for col in cols}}))</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="fish.pretty" href="#fish.pretty">pretty</a></li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="fish.DATA.add"><code class="name flex">
<span>def <span class="ident">add</span></span>(<span>i, row)</span>
</code></dt>
<dd>
<div class="desc"><p>For first row, build the <code>cols</code>. Otherwise, update summaries and the rows.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def add(i,row):
  &#34;For first row, build the `cols`. Otherwise, update summaries and the rows.&#34;
  if i.cols: i.rows += [i.cols.add(row)]
  else:      i.cols = COLS(row.cells)</code></pre>
</details>
</dd>
<dt id="fish.DATA.clone"><code class="name flex">
<span>def <span class="ident">clone</span></span>(<span>i, rows=[])</span>
</code></dt>
<dd>
<div class="desc"><p>Replicate structure of self.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def clone(i,rows=[]):
  &#34;Replicate structure of self.&#34;
  return DATA([ROW(i.cols.names)] + rows)</code></pre>
</details>
</dd>
<dt id="fish.DATA.dist"><code class="name flex">
<span>def <span class="ident">dist</span></span>(<span>i, row1, row2)</span>
</code></dt>
<dd>
<div class="desc"><p>distance between two values</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def dist(i,row1,row2):
  &#34;distance between two values&#34;
  return (sum(c.dist(row1.cells[c.at], row2.cells[c.at]) for c in i.cs.x)**the.p
         / len(i.cols.x))**(1/the.p)</code></pre>
</details>
</dd>
<dt id="fish.DATA.sort2"><code class="name flex">
<span>def <span class="ident">sort2</span></span>(<span>i, row1, row2)</span>
</code></dt>
<dd>
<div class="desc"><p>Return True if <code>row1</code> better than <code>row2</code>.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def sort2(i,row1,row2):
  &#34;Return True if `row1` better than `row2`.&#34;
  s1, s2, n = 0, 0, len(i.cols.y)
  for col in i.cols.y:
    a, b = col.norm(row1.at(col)), col.norm(row2.at(col))
    s1  -= math.exp(col.w * (a - b) / n)
    s2  -= math.exp(col.w * (b - a) / n)
  return s1 / n &lt; s2 / n</code></pre>
</details>
</dd>
<dt id="fish.DATA.sorted"><code class="name flex">
<span>def <span class="ident">sorted</span></span>(<span>i, rows=[])</span>
</code></dt>
<dd>
<div class="desc"><p>Sort all <code>rows</code>.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def sorted(i,rows=[]):
  &#34;Sort all `rows`.&#34;
  return sorted(rows or i.rows, key=cmp_to_key(lambda a,b: i.sort2(a,b)))</code></pre>
</details>
</dd>
<dt id="fish.DATA.stats"><code class="name flex">
<span>def <span class="ident">stats</span></span>(<span>i, cols=None, fun='mid', decimals=2)</span>
</code></dt>
<dd>
<div class="desc"><p>Report statistics on a set of <code>col</code>umns (defaults to <code>i.cols.y</code>.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def stats(i,cols=None, fun=&#34;mid&#34;, decimals=2):
  &#34;Report statistics on a set of `col`umns (defaults to `i.cols.y`.&#34;
  cols = cols or i.cols.y
  def what(col): return col.mid(decimals) if fun==&#34;mid&#34; else col.div(decimals)
  return BAG(mid=BAG(**{&#34;N+&#34;:cols[0].n, **{col.txt:what(col) for col in cols}}))</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="fish.TREE"><code class="flex name class">
<span>class <span class="ident">TREE</span></span>
<span>(</span><span>data)</span>
</code></dt>
<dd>
<div class="desc"><p>Recursively split on the cut (that most distinguishes different klasses).</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class TREE(object):
  &#34;Recursively split on the cut (that most distinguishes different klasses).&#34;
  def __init__(i,data):
    lst   = data.sorted()
    n     = int(len(lst)**the.min)
    bests = lst[-n:]
    rests = lst[:n*the.rest]
    for row in bests: row.klass = True
    for row in rests: row.klass = False
    i.data = data
    top = i.data.clone(bests+rests)
    i.stop = 2*len(top.rows)**the.min
    i.root = i.grow(top.rows,  BAG(here=top,at=None))

  def grow(i,rows, t):
    t.left,t.right = None,None
    if len(rows) &gt;= i.stop:
      _,at,op,cut,s = i.cut(i.data, i.data.cols.x, rows)
      if cut:
        left,right = [],[]
        [(left if ops[op](row.cells[at], cut) else right).append(row) for row in rows]
        if len(left) != len(rows) and len(right) != len(rows):
          t.left = i.grow(left,  BAG(here=i.data.clone(left), at=at,cut=cut,txt=s,op=op))
          t.right= i.grow(right, BAG(here=i.data.clone(right),at=at,cut=cut,txt=s,op=neg[op]))
    return t

  def cut(i,data,cols,rows):
    &#34;Return best `div,at,op,cut,txt` that most divides the klasses in `rows`.&#34;
    def sym(col):
      &#34;For syms, just return the one with least diversity of klasses.&#34;
      d = {}
      for row in rows:
        x = row.at(col)
        if x !=  &#34;?&#34;:
          d[x] = d.get(x, None) or SYM()
          d[x].cut = x
          d[x].add(row.klass)
      best = sorted(d.values(), key=lambda s:s.div())[0]
      return best.div(), col.at,&#34;==&#34;,best.cut if best.n &lt; col.n else None,col.txt
    #-----------
    def num(col):
      &#34;For nums, just return the cut that most reduces expected diversity.&#34;
      X     = lambda row: row.at(col)
      eps   = col.div()*the.cohen
      small = len(rows)**the.min
      all   = sorted([row for row in rows if X(row) != &#34;?&#34;], key=X)
      d1,d2,a,z = SYM(), SYM(), X(all[0]), X(all[-1])
      [d2.add(row.klass) for row in all]
      cut,n2,lo = None,len(all),d2.div()
      for n1,row in enumerate(all):
        n2, x, y = n2-1, X(row), row.klass
        d2.sub( d1.add(y) )
        if n1 &gt; small and n2 &gt; small and x != X(all[n1+1]) and x-a &gt; eps and z-x &gt; eps:
          xpect = (d1.div()*n1 + d2.div()*n2)/(n1+n2)
          if xpect &lt; lo:
            cut,lo = x,xpect
      return lo,col.at,&#34;&lt;=&#34;,cut,col.txt
    #------------------------------------
    return sorted([(num(col) if isa(col,NUM) else sym(col)) for col in cols])[0]

  def show(i):
    for lvl,t,isLeaf in i.nodes():
      if lvl==0:
        print(&#34;&#34;)
        print(t.here.stats().mid,end=&#34;&#34;)
      else:
        print(&#34;\n&#34;+(&#34;|.. &#34; * lvl)+ f&#34;{t.txt} {t.op} {t.cut} &#34;,end=&#34;&#34;)
        if isLeaf:  print(t.here.stats().mid,end=&#34;&#34;)
    print(&#34;&#34;)

  def nodes(i,t=None,lvl=0):
    t = t or i.root
    yield lvl,t,t.left==None
    for t1 in [t.left,t.right]:
      if t1:
        for lvl2,t2,isLeaf in i.nodes(t1,lvl+1): yield lvl2,t2, isLeaf</code></pre>
</details>
<h3>Methods</h3>
<dl>
<dt id="fish.TREE.grow"><code class="name flex">
<span>def <span class="ident">grow</span></span>(<span>i, rows, t)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def grow(i,rows, t):
  t.left,t.right = None,None
  if len(rows) &gt;= i.stop:
    _,at,op,cut,s = i.cut(i.data, i.data.cols.x, rows)
    if cut:
      left,right = [],[]
      [(left if ops[op](row.cells[at], cut) else right).append(row) for row in rows]
      if len(left) != len(rows) and len(right) != len(rows):
        t.left = i.grow(left,  BAG(here=i.data.clone(left), at=at,cut=cut,txt=s,op=op))
        t.right= i.grow(right, BAG(here=i.data.clone(right),at=at,cut=cut,txt=s,op=neg[op]))
  return t</code></pre>
</details>
</dd>
<dt id="fish.TREE.cut"><code class="name flex">
<span>def <span class="ident">cut</span></span>(<span>i, data, cols, rows)</span>
</code></dt>
<dd>
<div class="desc"><p>Return best <code>div,at,op,cut,txt</code> that most divides the klasses in <code>rows</code>.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def cut(i,data,cols,rows):
  &#34;Return best `div,at,op,cut,txt` that most divides the klasses in `rows`.&#34;
  def sym(col):
    &#34;For syms, just return the one with least diversity of klasses.&#34;
    d = {}
    for row in rows:
      x = row.at(col)
      if x !=  &#34;?&#34;:
        d[x] = d.get(x, None) or SYM()
        d[x].cut = x
        d[x].add(row.klass)
    best = sorted(d.values(), key=lambda s:s.div())[0]
    return best.div(), col.at,&#34;==&#34;,best.cut if best.n &lt; col.n else None,col.txt
  #-----------
  def num(col):
    &#34;For nums, just return the cut that most reduces expected diversity.&#34;
    X     = lambda row: row.at(col)
    eps   = col.div()*the.cohen
    small = len(rows)**the.min
    all   = sorted([row for row in rows if X(row) != &#34;?&#34;], key=X)
    d1,d2,a,z = SYM(), SYM(), X(all[0]), X(all[-1])
    [d2.add(row.klass) for row in all]
    cut,n2,lo = None,len(all),d2.div()
    for n1,row in enumerate(all):
      n2, x, y = n2-1, X(row), row.klass
      d2.sub( d1.add(y) )
      if n1 &gt; small and n2 &gt; small and x != X(all[n1+1]) and x-a &gt; eps and z-x &gt; eps:
        xpect = (d1.div()*n1 + d2.div()*n2)/(n1+n2)
        if xpect &lt; lo:
          cut,lo = x,xpect
    return lo,col.at,&#34;&lt;=&#34;,cut,col.txt
  #------------------------------------
  return sorted([(num(col) if isa(col,NUM) else sym(col)) for col in cols])[0]</code></pre>
</details>
</dd>
<dt id="fish.TREE.show"><code class="name flex">
<span>def <span class="ident">show</span></span>(<span>i)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def show(i):
  for lvl,t,isLeaf in i.nodes():
    if lvl==0:
      print(&#34;&#34;)
      print(t.here.stats().mid,end=&#34;&#34;)
    else:
      print(&#34;\n&#34;+(&#34;|.. &#34; * lvl)+ f&#34;{t.txt} {t.op} {t.cut} &#34;,end=&#34;&#34;)
      if isLeaf:  print(t.here.stats().mid,end=&#34;&#34;)
  print(&#34;&#34;)</code></pre>
</details>
</dd>
<dt id="fish.TREE.nodes"><code class="name flex">
<span>def <span class="ident">nodes</span></span>(<span>i, t=None, lvl=0)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def nodes(i,t=None,lvl=0):
  t = t or i.root
  yield lvl,t,t.left==None
  for t1 in [t.left,t.right]:
    if t1:
      for lvl2,t2,isLeaf in i.nodes(t1,lvl+1): yield lvl2,t2, isLeaf</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="fish.BAG"><code class="flex name class">
<span>class <span class="ident">BAG</span></span>
<span>(</span><span>*args, **kwargs)</span>
</code></dt>
<dd>
<div class="desc"><p>Dictionaries that can be accessed via <code>x["slot"]</code> or <code>x.slot</code>.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class BAG(dict):
  &#34;Dictionaries that can be accessed via `x[\&#34;slot\&#34;]` or `x.slot`.&#34;
  __getattr__ = dict.get</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>builtins.dict</li>
</ul>
<h3>Subclasses</h3>
<ul class="hlist">
<li><a title="fish.SETTINGS" href="#fish.SETTINGS">SETTINGS</a></li>
</ul>
</dd>
<dt id="fish.SETTINGS"><code class="flex name class">
<span>class <span class="ident">SETTINGS</span></span>
<span>(</span><span>s)</span>
</code></dt>
<dd>
<div class="desc"><p>Parse settings from string.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class SETTINGS(BAG):
  &#34;Parse settings from string.&#34;
  def __init__(i,s):
    for m in re.finditer(r&#34;\n\s*-\w+\s*--(\w+)[^=]*=\s*(\S+)&#34;,s): i[m[1]] = coerce(m[2])
  def cli(i):
    &#34;&#34;&#34;For k,v in i, update `v` if there is a command-line flag `-k[0]` or `--k`. Note
    that bookean values need no argument (since we will just negate `v`).&#34;&#34;&#34;
    for k,v in i.items():
      v = str(v)
      for j,x in enumerate(sys.argv):
        if (&#34;-&#34;+k[0]) == x or (&#34;--&#34;+k) == x:
          v = &#34;True&#34; if v==&#34;False&#34; else (&#34;False&#34; if v==&#34;True&#34; else sys.argv[j+1])
      i[k] = coerce(v)
  def showHelp(i,s):
    &#34;pretty print help string&#34;
    def bold(m):   return colored(m[0], attrs=[&#34;bold&#34;])
    def bright(m): return colored(m[0], &#34;light_yellow&#34;)
    def pretty(s): return re.sub(&#34;\n[A-Z][A-Z]+:&#34;, bold, re.sub(&#34; [-][-]?[\S]+&#34;, bright, s))
    print(pretty(s))
    print(pretty(&#34;\nACTIONS:&#34;))
    [print(pretty(f&#34;  -g   {k:8} {f.__doc__}&#34;)) for k,f in Egs.all.items() if k[0].isupper()]</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="fish.BAG" href="#fish.BAG">BAG</a></li>
<li>builtins.dict</li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="fish.SETTINGS.cli"><code class="name flex">
<span>def <span class="ident">cli</span></span>(<span>i)</span>
</code></dt>
<dd>
<div class="desc"><p>For k,v in i, update <code>v</code> if there is a command-line flag <code>-k[0]</code> or <code>--k</code>. Note
that bookean values need no argument (since we will just negate <code>v</code>).</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def cli(i):
  &#34;&#34;&#34;For k,v in i, update `v` if there is a command-line flag `-k[0]` or `--k`. Note
  that bookean values need no argument (since we will just negate `v`).&#34;&#34;&#34;
  for k,v in i.items():
    v = str(v)
    for j,x in enumerate(sys.argv):
      if (&#34;-&#34;+k[0]) == x or (&#34;--&#34;+k) == x:
        v = &#34;True&#34; if v==&#34;False&#34; else (&#34;False&#34; if v==&#34;True&#34; else sys.argv[j+1])
    i[k] = coerce(v)</code></pre>
</details>
</dd>
<dt id="fish.SETTINGS.showHelp"><code class="name flex">
<span>def <span class="ident">showHelp</span></span>(<span>i, s)</span>
</code></dt>
<dd>
<div class="desc"><p>pretty print help string</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def showHelp(i,s):
  &#34;pretty print help string&#34;
  def bold(m):   return colored(m[0], attrs=[&#34;bold&#34;])
  def bright(m): return colored(m[0], &#34;light_yellow&#34;)
  def pretty(s): return re.sub(&#34;\n[A-Z][A-Z]+:&#34;, bold, re.sub(&#34; [-][-]?[\S]+&#34;, bright, s))
  print(pretty(s))
  print(pretty(&#34;\nACTIONS:&#34;))
  [print(pretty(f&#34;  -g   {k:8} {f.__doc__}&#34;)) for k,f in Egs.all.items() if k[0].isupper()]</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="fish.Egs"><code class="flex name class">
<span>class <span class="ident">Egs</span></span>
</code></dt>
<dd>
<div class="desc"><p>Place to store the examples.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class Egs:
  &#34;Place to store the examples.&#34;
  all = locals()

  csv = [ &#34;pom.csv&#34;,
         &#34;nasa93dem.csv&#34;,
         &#34;healthCloseIsses12mths0011-easy.csv&#34;,
         &#34;healthCloseIsses12mths0001-hard.csv&#34;,
         &#34;coc10000.csv&#34;,
         &#34;coc1000.csv&#34;,
         &#34;china.csv&#34;,
         &#34;auto93.csv&#34;,
         &#34;auto2.csv&#34;,
         &#34;SSN.csv&#34;,
         &#34;SSM.csv&#34;]

  def ok():
    &#34;Run everything (except ok,h). Return how often something fails.&#34;
    fails, saved = 0, {k:v for k,v in the.items()}
    for what,fun in Egs.all.items():
      if what[0].isupper():
        yell(what + &#34; &#34;,&#34;yellow&#34;)
        fail = Egs.failure(saved,fun)
        yell(&#34; FAIL\n&#34;,&#34;red&#34;) if fail else yell(&#34; PASS\n&#34;,&#34;green&#34;)
        fails += fail
    yell(f&#34;TOTAL FAILURE(s) = {fails}\n&#34;, &#34;red&#34; if fails &gt; 0 else &#34;cyan&#34;)
    sys.exit(fails)

  def failure(saved,fun):
    &#34;&#34;&#34;Called by `Egs.ok`. `Fun` fails if it returns `False` or if it crashes.
    If it crashes, print the stack dump but then continue on
    Before running it, reset the system to  initial conditions.&#34;&#34;&#34;
    for k,v in saved.items(): the[k] = v
    random.seed(the.seed)
    fail = False
    try:    fail = fun() == False  # here, fail might be reset to True
    except: fail = True; traceback.print_exc()
    return fail

  def The():
    &#34;print the settings&#34;
    print(the)

  def Rnd():
    &#34;rnd to 2 decimals&#34;
    return 3.14 == rnd(math.pi,2)

  def Num(txt=&#34;&#34;):
    &#34;test NUMs&#34;
    n = NUM(txt)
    for x in range(10**4):  n.add(R()**.5)
    return .66 &lt; n.mid() &lt; .67 and .23 &lt;  n.div() &lt; .24 and n

  def Sym(txt=&#34;&#34;):
    &#34;test SYMs&#34;
    s=SYM(txt)
    [s.add(x) for x in &#34;aaaabbc&#34;]
    return &#34;a&#34;==s.mid() and 1.37 &lt;= s.div() &lt; 1.38 and s

  def Rows():
    &#34;Check we can load rows from file.&#34;
    print(the.file)
    for row in list(csv(the.file))[:5]: print(row) #[:5]: print(row)

  def Col():
    &#34;Check we can convert names to NUMs and SYMs.&#34;
    [print(x) for x in COLS([&#34;name&#34;,&#34;Age&#34;,&#34;Weight-&#34;]).all]

  def Data():
    &#34;Can we load data and get its stats?&#34;
    DATA(csv(the.file)).stats()

  def Clone():
    &#34;Can we replicate a DATA&#39;s structure?&#34;
    d1 = DATA(csv(the.file))
    d2= d1.clone(d1.rows)
    print(d1.cols.y[1])
    print(d2.cols.y[1])

  def Sorts():
    &#34;Can we sort rows into `best` and `rest`?&#34;
    d = DATA(csv(the.file))
    lst = d.sorted()
    m   = int(len(lst)**.5)
    best= d.clone(lst[-m:]);         print(&#34;all &#34;,d.stats())
    best= d.clone(lst[-m:]);         print(&#34;best&#34;,best.stats())
    rest= d.clone(lst[:m*the.rest]); print(&#34;rest&#34;,rest.stats())

  def Nodes():
    &#34;Does the TREE iterator work?&#34;
    t1 = TREE(DATA(csv(the.file)))
    for lvl,t2,isLeaf in t1.nodes():
        print(&#34;|.. &#34; * lvl,isLeaf)

  def Tree():
    &#34;Does the TREE pretty print work?&#34;
    TREE( DATA(csv(the.file)) ).show()

  def Trees():
    &#34;Test all tree generation of all csv files.&#34;
    for f in Egs.csv:
      print(&#34;\n\n-----------&#34;,f)
      TREE( DATA(csv(f&#34;../data/{f}&#34;)) ).show()</code></pre>
</details>
<h3>Class variables</h3>
<dl>
<dt id="fish.Egs.all"><code class="name">var <span class="ident">all</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="fish.Egs.csv"><code class="name">var <span class="ident">csv</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="fish.Egs.ok"><code class="name flex">
<span>def <span class="ident">ok</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Run everything (except ok,h). Return how often something fails.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def ok():
  &#34;Run everything (except ok,h). Return how often something fails.&#34;
  fails, saved = 0, {k:v for k,v in the.items()}
  for what,fun in Egs.all.items():
    if what[0].isupper():
      yell(what + &#34; &#34;,&#34;yellow&#34;)
      fail = Egs.failure(saved,fun)
      yell(&#34; FAIL\n&#34;,&#34;red&#34;) if fail else yell(&#34; PASS\n&#34;,&#34;green&#34;)
      fails += fail
  yell(f&#34;TOTAL FAILURE(s) = {fails}\n&#34;, &#34;red&#34; if fails &gt; 0 else &#34;cyan&#34;)
  sys.exit(fails)</code></pre>
</details>
</dd>
<dt id="fish.Egs.failure"><code class="name flex">
<span>def <span class="ident">failure</span></span>(<span>saved, fun)</span>
</code></dt>
<dd>
<div class="desc"><p>Called by <code><a title="fish.Egs.ok" href="#fish.Egs.ok">Egs.ok()</a></code>. <code>Fun</code> fails if it returns <code>False</code> or if it crashes.
If it crashes, print the stack dump but then continue on
Before running it, reset the system to
initial conditions.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def failure(saved,fun):
  &#34;&#34;&#34;Called by `Egs.ok`. `Fun` fails if it returns `False` or if it crashes.
  If it crashes, print the stack dump but then continue on
  Before running it, reset the system to  initial conditions.&#34;&#34;&#34;
  for k,v in saved.items(): the[k] = v
  random.seed(the.seed)
  fail = False
  try:    fail = fun() == False  # here, fail might be reset to True
  except: fail = True; traceback.print_exc()
  return fail</code></pre>
</details>
</dd>
<dt id="fish.Egs.The"><code class="name flex">
<span>def <span class="ident">The</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>print the settings</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def The():
  &#34;print the settings&#34;
  print(the)</code></pre>
</details>
</dd>
<dt id="fish.Egs.Rnd"><code class="name flex">
<span>def <span class="ident">Rnd</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>rnd to 2 decimals</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def Rnd():
  &#34;rnd to 2 decimals&#34;
  return 3.14 == rnd(math.pi,2)</code></pre>
</details>
</dd>
<dt id="fish.Egs.Num"><code class="name flex">
<span>def <span class="ident">Num</span></span>(<span>txt='')</span>
</code></dt>
<dd>
<div class="desc"><p>test NUMs</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def Num(txt=&#34;&#34;):
  &#34;test NUMs&#34;
  n = NUM(txt)
  for x in range(10**4):  n.add(R()**.5)
  return .66 &lt; n.mid() &lt; .67 and .23 &lt;  n.div() &lt; .24 and n</code></pre>
</details>
</dd>
<dt id="fish.Egs.Sym"><code class="name flex">
<span>def <span class="ident">Sym</span></span>(<span>txt='')</span>
</code></dt>
<dd>
<div class="desc"><p>test SYMs</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def Sym(txt=&#34;&#34;):
  &#34;test SYMs&#34;
  s=SYM(txt)
  [s.add(x) for x in &#34;aaaabbc&#34;]
  return &#34;a&#34;==s.mid() and 1.37 &lt;= s.div() &lt; 1.38 and s</code></pre>
</details>
</dd>
<dt id="fish.Egs.Rows"><code class="name flex">
<span>def <span class="ident">Rows</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Check we can load rows from file.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def Rows():
  &#34;Check we can load rows from file.&#34;
  print(the.file)
  for row in list(csv(the.file))[:5]: print(row) #[:5]: print(row)</code></pre>
</details>
</dd>
<dt id="fish.Egs.Col"><code class="name flex">
<span>def <span class="ident">Col</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Check we can convert names to NUMs and SYMs.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def Col():
  &#34;Check we can convert names to NUMs and SYMs.&#34;
  [print(x) for x in COLS([&#34;name&#34;,&#34;Age&#34;,&#34;Weight-&#34;]).all]</code></pre>
</details>
</dd>
<dt id="fish.Egs.Data"><code class="name flex">
<span>def <span class="ident">Data</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Can we load data and get its stats?</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def Data():
  &#34;Can we load data and get its stats?&#34;
  DATA(csv(the.file)).stats()</code></pre>
</details>
</dd>
<dt id="fish.Egs.Clone"><code class="name flex">
<span>def <span class="ident">Clone</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Can we replicate a DATA's structure?</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def Clone():
  &#34;Can we replicate a DATA&#39;s structure?&#34;
  d1 = DATA(csv(the.file))
  d2= d1.clone(d1.rows)
  print(d1.cols.y[1])
  print(d2.cols.y[1])</code></pre>
</details>
</dd>
<dt id="fish.Egs.Sorts"><code class="name flex">
<span>def <span class="ident">Sorts</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Can we sort rows into <code>best</code> and <code>rest</code>?</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def Sorts():
  &#34;Can we sort rows into `best` and `rest`?&#34;
  d = DATA(csv(the.file))
  lst = d.sorted()
  m   = int(len(lst)**.5)
  best= d.clone(lst[-m:]);         print(&#34;all &#34;,d.stats())
  best= d.clone(lst[-m:]);         print(&#34;best&#34;,best.stats())
  rest= d.clone(lst[:m*the.rest]); print(&#34;rest&#34;,rest.stats())</code></pre>
</details>
</dd>
<dt id="fish.Egs.Nodes"><code class="name flex">
<span>def <span class="ident">Nodes</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Does the TREE iterator work?</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def Nodes():
  &#34;Does the TREE iterator work?&#34;
  t1 = TREE(DATA(csv(the.file)))
  for lvl,t2,isLeaf in t1.nodes():
      print(&#34;|.. &#34; * lvl,isLeaf)</code></pre>
</details>
</dd>
<dt id="fish.Egs.Tree"><code class="name flex">
<span>def <span class="ident">Tree</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Does the TREE pretty print work?</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def Tree():
  &#34;Does the TREE pretty print work?&#34;
  TREE( DATA(csv(the.file)) ).show()</code></pre>
</details>
</dd>
<dt id="fish.Egs.Trees"><code class="name flex">
<span>def <span class="ident">Trees</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Test all tree generation of all csv files.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def Trees():
  &#34;Test all tree generation of all csv files.&#34;
  for f in Egs.csv:
    print(&#34;\n\n-----------&#34;,f)
    TREE( DATA(csv(f&#34;../data/{f}&#34;)) ).show()</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<center>
<img src="Fly-Fishing_art.png" width=300>
<p>
<a href="https://github.com/4src/fish"><img width=30 src="github-mark.png"></a>
<br>
<img
src="https://img.shields.io/badge/language-python3.11-yellow"> <img
src="results.png"> <img
src="https://img.shields.io/badge/license-BSD2-ff69b4"> <a
href="https://zenodo.org/badge/latestdoi/631627449"><img
src="https://img.shields.io/badge/purpose-se--ai-blueviolet"> <img
src="https://img.shields.io/badge/platform-osx,linux-pink"> <a
href="https://zenodo.org/badge/latestdoi/631627449"><img
src="https://zenodo.org/badge/631627449.svg"></a>
<br> <hr>
<br></center>
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3><a href="#header-variables">Global variables</a></h3>
<ul class="">
<li><code><a title="fish.ops" href="#fish.ops">ops</a></code></li>
<li><code><a title="fish.neg" href="#fish.neg">neg</a></code></li>
<li><code><a title="fish.big" href="#fish.big">big</a></code></li>
<li><code><a title="fish.the" href="#fish.the">the</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="fish.R" href="#fish.R">R</a></code></li>
<li><code><a title="fish.coerce" href="#fish.coerce">coerce</a></code></li>
<li><code><a title="fish.csv" href="#fish.csv">csv</a></code></li>
<li><code><a title="fish.rnd" href="#fish.rnd">rnd</a></code></li>
<li><code><a title="fish.yell" href="#fish.yell">yell</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="fish.pretty" href="#fish.pretty">pretty</a></code></h4>
</li>
<li>
<h4><code><a title="fish.ROW" href="#fish.ROW">ROW</a></code></h4>
<ul class="">
<li><code><a title="fish.ROW.at" href="#fish.ROW.at">at</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="fish.COL" href="#fish.COL">COL</a></code></h4>
<ul class="">
<li><code><a title="fish.COL.add" href="#fish.COL.add">add</a></code></li>
<li><code><a title="fish.COL.dist" href="#fish.COL.dist">dist</a></code></li>
<li><code><a title="fish.COL.sub" href="#fish.COL.sub">sub</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="fish.NUM" href="#fish.NUM">NUM</a></code></h4>
<ul class="two-column">
<li><code><a title="fish.NUM.add1" href="#fish.NUM.add1">add1</a></code></li>
<li><code><a title="fish.NUM.dist1" href="#fish.NUM.dist1">dist1</a></code></li>
<li><code><a title="fish.NUM.div" href="#fish.NUM.div">div</a></code></li>
<li><code><a title="fish.NUM.mid" href="#fish.NUM.mid">mid</a></code></li>
<li><code><a title="fish.NUM.norm" href="#fish.NUM.norm">norm</a></code></li>
<li><code><a title="fish.NUM.sub1" href="#fish.NUM.sub1">sub1</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="fish.SYM" href="#fish.SYM">SYM</a></code></h4>
<ul class="">
<li><code><a title="fish.SYM.add1" href="#fish.SYM.add1">add1</a></code></li>
<li><code><a title="fish.SYM.dist1" href="#fish.SYM.dist1">dist1</a></code></li>
<li><code><a title="fish.SYM.div" href="#fish.SYM.div">div</a></code></li>
<li><code><a title="fish.SYM.mid" href="#fish.SYM.mid">mid</a></code></li>
<li><code><a title="fish.SYM.sub1" href="#fish.SYM.sub1">sub1</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="fish.COLS" href="#fish.COLS">COLS</a></code></h4>
<ul class="">
<li><code><a title="fish.COLS.add" href="#fish.COLS.add">add</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="fish.DATA" href="#fish.DATA">DATA</a></code></h4>
<ul class="two-column">
<li><code><a title="fish.DATA.add" href="#fish.DATA.add">add</a></code></li>
<li><code><a title="fish.DATA.clone" href="#fish.DATA.clone">clone</a></code></li>
<li><code><a title="fish.DATA.dist" href="#fish.DATA.dist">dist</a></code></li>
<li><code><a title="fish.DATA.sort2" href="#fish.DATA.sort2">sort2</a></code></li>
<li><code><a title="fish.DATA.sorted" href="#fish.DATA.sorted">sorted</a></code></li>
<li><code><a title="fish.DATA.stats" href="#fish.DATA.stats">stats</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="fish.TREE" href="#fish.TREE">TREE</a></code></h4>
<ul class="">
<li><code><a title="fish.TREE.grow" href="#fish.TREE.grow">grow</a></code></li>
<li><code><a title="fish.TREE.cut" href="#fish.TREE.cut">cut</a></code></li>
<li><code><a title="fish.TREE.show" href="#fish.TREE.show">show</a></code></li>
<li><code><a title="fish.TREE.nodes" href="#fish.TREE.nodes">nodes</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="fish.BAG" href="#fish.BAG">BAG</a></code></h4>
</li>
<li>
<h4><code><a title="fish.SETTINGS" href="#fish.SETTINGS">SETTINGS</a></code></h4>
<ul class="">
<li><code><a title="fish.SETTINGS.cli" href="#fish.SETTINGS.cli">cli</a></code></li>
<li><code><a title="fish.SETTINGS.showHelp" href="#fish.SETTINGS.showHelp">showHelp</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="fish.Egs" href="#fish.Egs">Egs</a></code></h4>
<ul class="two-column">
<li><code><a title="fish.Egs.ok" href="#fish.Egs.ok">ok</a></code></li>
<li><code><a title="fish.Egs.failure" href="#fish.Egs.failure">failure</a></code></li>
<li><code><a title="fish.Egs.The" href="#fish.Egs.The">The</a></code></li>
<li><code><a title="fish.Egs.Rnd" href="#fish.Egs.Rnd">Rnd</a></code></li>
<li><code><a title="fish.Egs.Num" href="#fish.Egs.Num">Num</a></code></li>
<li><code><a title="fish.Egs.Sym" href="#fish.Egs.Sym">Sym</a></code></li>
<li><code><a title="fish.Egs.Rows" href="#fish.Egs.Rows">Rows</a></code></li>
<li><code><a title="fish.Egs.Col" href="#fish.Egs.Col">Col</a></code></li>
<li><code><a title="fish.Egs.Data" href="#fish.Egs.Data">Data</a></code></li>
<li><code><a title="fish.Egs.Clone" href="#fish.Egs.Clone">Clone</a></code></li>
<li><code><a title="fish.Egs.Sorts" href="#fish.Egs.Sorts">Sorts</a></code></li>
<li><code><a title="fish.Egs.Nodes" href="#fish.Egs.Nodes">Nodes</a></code></li>
<li><code><a title="fish.Egs.Tree" href="#fish.Egs.Tree">Tree</a></code></li>
<li><code><a title="fish.Egs.Trees" href="#fish.Egs.Trees">Trees</a></code></li>
<li><code><a title="fish.Egs.all" href="#fish.Egs.all">all</a></code></li>
<li><code><a title="fish.Egs.csv" href="#fish.Egs.csv">csv</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>